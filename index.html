<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>D3 Chart Examples</title>

	<style>
	body {
		background:#EFEFEF;
	}
	</style>

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<!--[if lte IE 8]><script src="//cdnjs.cloudflare.com/ajax/libs/r2d3/0.2.0/r2d3.min.js"></script><![endif]-->
	<!--[if gte IE 9]><!-->
		<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.5/d3.min.js"></script>
	<!--<![endif]-->
</head>
<body>
	
	<div id="target"></div>

	<script src="data-structures.js"></script>
	<script src="d3.jqcharts.core.js"></script>
	<script src="d3.jqcharts.pie.js"></script>
	<script src="d3.jqcharts.bar.js"></script>

	<script type="text/javascript">
	var charts = {};

	jqCharts.Pie.defaults.strokeColor = '#785F7F';
	jqCharts.Pie.defaults.strokeWidth = 0.8;
	jqCharts.Pie.defaults.width = 250;
	jqCharts.Pie.defaults.height = 250;
	jqCharts.Pie.defaults.labelSize = 10;
	jqCharts.Pie.defaults.labelDistance = 5;

	jqCharts.Bar.defaults.width = 250;
	jqCharts.Bar.defaults.height = 250;

	$(buildPie);
	$(buildBar);
	setInterval(updateCharts, 2e3);

	// render pie
	function buildPie() {
		var newChart = new jqCharts.Pie({
			element: '#target',
			data: data.pie
		});
		charts.pie = newChart;

		$('body').on('update', function(){
			updateChart(newChart, data.pie);
		});
	}

	// render stacked bar
	function buildBar(){
		var newChart = new jqCharts.Bar({
			element: '#target',
			yLabel: 'Recipients',
			data: data.barStacked
		});
		charts.bar = newChart;

		$('body').on('update', function(){
			updateChart(newChart, data.barStacked);
		});
	}

	// get them all animating
	function updateCharts() {
		$('body').trigger('update');
	}
	function updateChart(chart, data) {
		var newData = $.extend(true, {}, data);
		var keyIndex = Math.floor(Math.random() * newData.label.length);
		var key = newData.label[keyIndex];
		var max = d3.max(newData.value, function(d){
			if (d instanceof Array) return d3.max(d);
			else return d;
		});
		var value = Math.ceil(Math.random() * max);

		if (newData.value[keyIndex] instanceof Array) {
			newData.value[keyIndex][Math.floor(Math.random() * newData.value[keyIndex].length)] = value;
			value = newData.value[keyIndex];
		}

		chart.value(key, value);
		return [key, value];
	}
	</script>
</body>
</html>