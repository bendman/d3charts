<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>D3 Chart Examples</title>

	<style>
	body {
		background:#EFEFEF;
	}
	</style>

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<!--[if lte IE 8]><script src="//cdnjs.cloudflare.com/ajax/libs/r2d3/0.2.0/r2d3.min.js"></script><![endif]-->
	<!--[if gte IE 9]><!-->
		<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.5/d3.min.js"></script>
	<!--<![endif]-->
</head>
<body>
	
	<div id="pie"></div>
	<div id="stackedbar"></div>

	<script src="data-structures.js"></script>
	<script src="d3.jqcharts.core.js"></script>
	<script src="d3.jqcharts.pie.js"></script>
	<script src="d3.jqcharts.bar.js"></script>

	<script type="text/javascript">
	var charts = {};

	$(buildPie);
	$(buildBar);

	// render pie
	function buildPie() {
		charts.pie = new jqCharts.Pie({
			element: '#pie',
			height: 380,
			width: 450,
			strokeColor: '#785F7F',
			data: data.pie
		});
	}

	setInterval(updateCharts, 2e3);

	// render stacked bar
	function buildBar(){
		charts.bar = new jqCharts.Bar({
			element: '#stackedbar',
			yLabel: 'Recipients',
			data: data.barStacked
		});
	}

	// get them all animating
	function updateChart(chart, data) {
		var newData = $.extend(true, {}, data);
		var keyIndex = Math.floor(Math.random() * newData.label.length);
		var key = newData.label[keyIndex];
		var max = d3.max(data.value, function(d){
			if (d instanceof Array) return d3.max(d);
			else return d;
		});
		var value = Math.ceil(Math.random() * max);

		if (newData.value[keyIndex] instanceof Array) {
			newData.value[keyIndex][Math.floor(Math.random() * newData.value[keyIndex].length)] = value;
			value = newData.value[keyIndex];
		}

		chart.value(key, value);
		return [key, value];
	}
	function updateCharts() {
		console.log('pie', updateChart(charts.pie, data.pie));
		console.log('bar', updateChart(charts.bar, data.barStacked));
	}
	</script>
</body>
</html>